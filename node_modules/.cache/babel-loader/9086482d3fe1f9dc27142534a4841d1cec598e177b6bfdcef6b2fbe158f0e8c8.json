{"ast":null,"code":"import{useRef,useState,useEffect}from'react';import useAuth from'../hooks/useAuth';import{Link,useNavigate,useLocation}from'react-router-dom';import axios from'../api/axios';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const LOGIN_URL='/auth';const Login=()=>{var _location$state,_location$state$from;const{setAuth}=useAuth();const navigate=useNavigate();const location=useLocation();const from=((_location$state=location.state)===null||_location$state===void 0?void 0:(_location$state$from=_location$state.from)===null||_location$state$from===void 0?void 0:_location$state$from.pathname)||\"/\";const userRef=useRef();const errRef=useRef();const[user,setUser]=useState('');const[pwd,setPwd]=useState('');const[errMsg,setErrMsg]=useState('');useEffect(()=>{userRef.current.focus();},[]);useEffect(()=>{setErrMsg('');},[user,pwd]);const handleSubmit=async e=>{e.preventDefault();try{var _response$data,_response$data2;const response=await axios.post(LOGIN_URL,JSON.stringify({user,pwd}),{headers:{'Content-Type':'application/json'},withCredentials:true});console.log(JSON.stringify(response===null||response===void 0?void 0:response.data));//console.log(JSON.stringify(response));\nconst accessToken=response===null||response===void 0?void 0:(_response$data=response.data)===null||_response$data===void 0?void 0:_response$data.accessToken;const roles=response===null||response===void 0?void 0:(_response$data2=response.data)===null||_response$data2===void 0?void 0:_response$data2.roles;setAuth({user,pwd,roles,accessToken});setUser('');setPwd('');navigate(from,{replace:true});}catch(err){var _err$response,_err$response2;if(!(err!==null&&err!==void 0&&err.response)){setErrMsg('No Server Response');}else if(((_err$response=err.response)===null||_err$response===void 0?void 0:_err$response.status)===400){setErrMsg('Missing Username or Password');}else if(((_err$response2=err.response)===null||_err$response2===void 0?void 0:_err$response2.status)===401){setErrMsg('Unauthorized');}else{setErrMsg('Login Failed');}errRef.current.focus();}};return/*#__PURE__*/_jsxs(\"section\",{children:[/*#__PURE__*/_jsx(\"p\",{ref:errRef,className:errMsg?\"errmsg\":\"offscreen\",\"aria-live\":\"assertive\",children:errMsg}),/*#__PURE__*/_jsx(\"h1\",{children:\"Sign In\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"username\",children:\"Username:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",id:\"username\",ref:userRef,autoComplete:\"off\",onChange:e=>setUser(e.target.value),value:user,required:true}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"password\",children:\"Password:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",id:\"password\",onChange:e=>setPwd(e.target.value),value:pwd,required:true}),/*#__PURE__*/_jsx(\"button\",{children:\"Sign In\"})]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Need an Account?\",/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"span\",{className:\"line\",children:/*#__PURE__*/_jsx(Link,{to:\"/register\",children:\"Sign Up\"})})]})]});};export default Login;","map":{"version":3,"names":["useRef","useState","useEffect","useAuth","Link","useNavigate","useLocation","axios","jsx","_jsx","jsxs","_jsxs","LOGIN_URL","Login","_location$state","_location$state$from","setAuth","navigate","location","from","state","pathname","userRef","errRef","user","setUser","pwd","setPwd","errMsg","setErrMsg","current","focus","handleSubmit","e","preventDefault","_response$data","_response$data2","response","post","JSON","stringify","headers","withCredentials","console","log","data","accessToken","roles","replace","err","_err$response","_err$response2","status","children","ref","className","onSubmit","htmlFor","type","id","autoComplete","onChange","target","value","required","to"],"sources":["C:/Users/nguem/IdeaProjects/tradeadviser/src/components/Login.js"],"sourcesContent":["import { useRef, useState, useEffect } from 'react';\r\nimport useAuth from '../hooks/useAuth';\r\nimport { Link, useNavigate, useLocation } from 'react-router-dom';\r\n\r\nimport axios from '../api/axios';\r\nconst LOGIN_URL = '/auth';\r\n\r\nconst Login = () => {\r\n    const { setAuth } = useAuth();\r\n\r\n    const navigate = useNavigate();\r\n    const location = useLocation();\r\n    const from = location.state?.from?.pathname || \"/\";\r\n\r\n    const userRef = useRef();\r\n    const errRef = useRef();\r\n\r\n    const [user, setUser] = useState('');\r\n    const [pwd, setPwd] = useState('');\r\n    const [errMsg, setErrMsg] = useState('');\r\n\r\n    useEffect(() => {\r\n        userRef.current.focus();\r\n    }, [])\r\n\r\n    useEffect(() => {\r\n        setErrMsg('');\r\n    }, [user, pwd])\r\n\r\n    const handleSubmit = async (e) => {\r\n        e.preventDefault();\r\n\r\n        try {\r\n            const response = await axios.post(LOGIN_URL,\r\n                JSON.stringify({ user, pwd }),\r\n                {\r\n                    headers: { 'Content-Type': 'application/json' },\r\n                    withCredentials: true\r\n                }\r\n            );\r\n            console.log(JSON.stringify(response?.data));\r\n            //console.log(JSON.stringify(response));\r\n            const accessToken = response?.data?.accessToken;\r\n            const roles = response?.data?.roles;\r\n            setAuth({ user, pwd, roles, accessToken });\r\n            setUser('');\r\n            setPwd('');\r\n            navigate(from, { replace: true });\r\n        } catch (err) {\r\n            if (!err?.response) {\r\n                setErrMsg('No Server Response');\r\n            } else if (err.response?.status === 400) {\r\n                setErrMsg('Missing Username or Password');\r\n            } else if (err.response?.status === 401) {\r\n                setErrMsg('Unauthorized');\r\n            } else {\r\n                setErrMsg('Login Failed');\r\n            }\r\n            errRef.current.focus();\r\n        }\r\n    }\r\n\r\n    return (\r\n\r\n        <section>\r\n            <p ref={errRef} className={errMsg ? \"errmsg\" : \"offscreen\"} aria-live=\"assertive\">{errMsg}</p>\r\n            <h1>Sign In</h1>\r\n            <form onSubmit={handleSubmit}>\r\n                <label htmlFor=\"username\">Username:</label>\r\n                <input\r\n                    type=\"text\"\r\n                    id=\"username\"\r\n                    ref={userRef}\r\n                    autoComplete=\"off\"\r\n                    onChange={(e) => setUser(e.target.value)}\r\n                    value={user}\r\n                    required\r\n                />\r\n\r\n                <label htmlFor=\"password\">Password:</label>\r\n                <input\r\n                    type=\"password\"\r\n                    id=\"password\"\r\n                    onChange={(e) => setPwd(e.target.value)}\r\n                    value={pwd}\r\n                    required\r\n                />\r\n                <button>Sign In</button>\r\n            </form>\r\n            <p>\r\n                Need an Account?<br />\r\n                <span className=\"line\">\r\n                    <Link to=\"/register\">Sign Up</Link>\r\n                </span>\r\n            </p>\r\n        </section>\r\n\r\n    )\r\n}\r\n\r\nexport default Login\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}