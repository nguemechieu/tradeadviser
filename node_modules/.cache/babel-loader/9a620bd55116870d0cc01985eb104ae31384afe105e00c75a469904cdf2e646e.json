{"ast":null,"code":"import{axiosPrivate}from\"../api/axios\";import{useEffect}from\"react\";import useRefreshToken from\"./useRefreshToken\";import useAuth from\"./useAuth\";const useAxiosPrivate=()=>{const refresh=useRefreshToken();const{auth}=useAuth();useEffect(()=>{const requestIntercept=axiosPrivate.interceptors.request.use(config=>{if(!config.headers['Authorization']){config.headers['Authorization']=`Bearer ${auth===null||auth===void 0?void 0:auth.accessToken}`;}return config;},error=>Promise.reject(error));const responseIntercept=axiosPrivate.interceptors.response.use(response=>response,async error=>{var _error$response;const prevRequest=error===null||error===void 0?void 0:error.config;if((error===null||error===void 0?void 0:(_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.status)===403&&!(prevRequest!==null&&prevRequest!==void 0&&prevRequest.sent)){prevRequest.sent=true;const newAccessToken=await refresh();prevRequest.headers['Authorization']=`Bearer ${newAccessToken}`;return axiosPrivate(prevRequest);}return Promise.reject(error);});return()=>{axiosPrivate.interceptors.request.eject(requestIntercept);axiosPrivate.interceptors.response.eject(responseIntercept);};},[auth,refresh]);return axiosPrivate;};export default useAxiosPrivate;","map":{"version":3,"names":["axiosPrivate","useEffect","useRefreshToken","useAuth","useAxiosPrivate","refresh","auth","requestIntercept","interceptors","request","use","config","headers","accessToken","error","Promise","reject","responseIntercept","response","_error$response","prevRequest","status","sent","newAccessToken","eject"],"sources":["C:/Users/nguem/IdeaProjects/tradeadviser/src/hooks/useAxiosPrivate.js"],"sourcesContent":["import { axiosPrivate } from \"../api/axios\";\nimport { useEffect } from \"react\";\nimport useRefreshToken from \"./useRefreshToken\";\nimport useAuth from \"./useAuth\";\n\nconst useAxiosPrivate = () => {\n    const refresh = useRefreshToken();\n    const { auth } = useAuth();\n\n    useEffect(() => {\n\n        const requestIntercept = axiosPrivate.interceptors.request.use(\n            config => {\n                if (!config.headers['Authorization']) {\n                    config.headers['Authorization'] = `Bearer ${auth?.accessToken}`;\n                }\n                return config;\n            }, (error) => Promise.reject(error)\n        );\n\n        const responseIntercept = axiosPrivate.interceptors.response.use(\n            response => response,\n            async (error) => {\n                const prevRequest = error?.config;\n                if (error?.response?.status === 403 && !prevRequest?.sent) {\n                    prevRequest.sent = true;\n                    const newAccessToken = await refresh();\n                    prevRequest.headers['Authorization'] = `Bearer ${newAccessToken}`;\n                    return axiosPrivate(prevRequest);\n                }\n                return Promise.reject(error);\n            }\n        );\n\n        return () => {\n            axiosPrivate.interceptors.request.eject(requestIntercept);\n            axiosPrivate.interceptors.response.eject(responseIntercept);\n        }\n    }, [auth, refresh])\n\n    return axiosPrivate;\n}\n\nexport default useAxiosPrivate;"],"mappings":"AAAA,OAASA,YAAY,KAAQ,cAAc,CAC3C,OAASC,SAAS,KAAQ,OAAO,CACjC,MAAO,CAAAC,eAAe,KAAM,mBAAmB,CAC/C,MAAO,CAAAC,OAAO,KAAM,WAAW,CAE/B,KAAM,CAAAC,eAAe,CAAGA,CAAA,GAAM,CAC1B,KAAM,CAAAC,OAAO,CAAGH,eAAe,CAAC,CAAC,CACjC,KAAM,CAAEI,IAAK,CAAC,CAAGH,OAAO,CAAC,CAAC,CAE1BF,SAAS,CAAC,IAAM,CAEZ,KAAM,CAAAM,gBAAgB,CAAGP,YAAY,CAACQ,YAAY,CAACC,OAAO,CAACC,GAAG,CAC1DC,MAAM,EAAI,CACN,GAAI,CAACA,MAAM,CAACC,OAAO,CAAC,eAAe,CAAC,CAAE,CAClCD,MAAM,CAACC,OAAO,CAAC,eAAe,CAAC,CAAG,UAAUN,IAAI,SAAJA,IAAI,iBAAJA,IAAI,CAAEO,WAAW,EAAE,CACnE,CACA,MAAO,CAAAF,MAAM,CACjB,CAAC,CAAGG,KAAK,EAAKC,OAAO,CAACC,MAAM,CAACF,KAAK,CACtC,CAAC,CAED,KAAM,CAAAG,iBAAiB,CAAGjB,YAAY,CAACQ,YAAY,CAACU,QAAQ,CAACR,GAAG,CAC5DQ,QAAQ,EAAIA,QAAQ,CACpB,KAAO,CAAAJ,KAAK,EAAK,KAAAK,eAAA,CACb,KAAM,CAAAC,WAAW,CAAGN,KAAK,SAALA,KAAK,iBAALA,KAAK,CAAEH,MAAM,CACjC,GAAI,CAAAG,KAAK,SAALA,KAAK,kBAAAK,eAAA,CAALL,KAAK,CAAEI,QAAQ,UAAAC,eAAA,iBAAfA,eAAA,CAAiBE,MAAM,IAAK,GAAG,EAAI,EAACD,WAAW,SAAXA,WAAW,WAAXA,WAAW,CAAEE,IAAI,EAAE,CACvDF,WAAW,CAACE,IAAI,CAAG,IAAI,CACvB,KAAM,CAAAC,cAAc,CAAG,KAAM,CAAAlB,OAAO,CAAC,CAAC,CACtCe,WAAW,CAACR,OAAO,CAAC,eAAe,CAAC,CAAG,UAAUW,cAAc,EAAE,CACjE,MAAO,CAAAvB,YAAY,CAACoB,WAAW,CAAC,CACpC,CACA,MAAO,CAAAL,OAAO,CAACC,MAAM,CAACF,KAAK,CAAC,CAChC,CACJ,CAAC,CAED,MAAO,IAAM,CACTd,YAAY,CAACQ,YAAY,CAACC,OAAO,CAACe,KAAK,CAACjB,gBAAgB,CAAC,CACzDP,YAAY,CAACQ,YAAY,CAACU,QAAQ,CAACM,KAAK,CAACP,iBAAiB,CAAC,CAC/D,CAAC,CACL,CAAC,CAAE,CAACX,IAAI,CAAED,OAAO,CAAC,CAAC,CAEnB,MAAO,CAAAL,YAAY,CACvB,CAAC,CAED,cAAe,CAAAI,eAAe","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}